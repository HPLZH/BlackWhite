<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            padding: 10px;
        }

        button.GW,
        button.GB {
            height: 30px;
            width: 30px;
        }

        button.GW {
            background-color: white;
        }

        button.GB {
            background-color: black;
        }

        body>div {
            margin-top: 20px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 10px;
            width: fit-content;
            height: fit-content;
        }

        table {
            border-collapse: collapse;
        }

        table,
        th,
        td {
            white-space: nowrap;
        }
    </style>
    <script>

        // BW_Main.js

        var blocks = null;
        var gameSize;

        function initGame(size) {
            blocks = []
            gameSize = size;
            for (ir = 0; ir < size; ir++) {
                blocks[ir] = [];
                for (ic = 0; ic < size; ic++) {
                    blocks[ir][ic] = false;
                }
            }
        }

        function buttonClick(r, c) {
            blockClick(r, c);
            MakeHash();
        }

        function blockClick(r, c) {
            tryChange(r, c);
            tryChange(r + 1, c);
            tryChange(r - 1, c);
            tryChange(r, c + 1);
            tryChange(r, c - 1);
        }

        function tryChange(r, c) {
            if (r >= 0 && c >= 0 && r < gameSize && c < gameSize) {
                ChangeColor(r, c);
                blocks[r][c] = !blocks[r][c];
            }
        }

        function setBlock(r, c, value) {
            SetColor(r, c, value);
            blocks[r][c] = value;
        }

        function randomClick() {
            clearGame();
            for (ir = 0; ir < gameSize; ir++) {
                for (ic = 0; ic < gameSize; ic++) {
                    if (Math.random() < 0.5) {
                        blockClick(ir, ic);
                    }
                }
            }
            MakeHash();
        }

        function randomSet() {
            for (ir = 0; ir < gameSize; ir++) {
                for (ic = 0; ic < gameSize; ic++) {
                    setBlock(ir, ic, Math.random() < 0.5);
                }
            }
            MakeHash();
        }

        function clearGame() {
            for (ir = 0; ir < gameSize; ir++) {
                for (ic = 0; ic < gameSize; ic++) {
                    setBlock(ir, ic, false);
                }
            }
            MakeHash();
        }

        // BW_HTML.js

        function GetButton(r, c) {
            return document.getElementById("R" + r + "C" + c);
        }

        function ChangeColor(r, c) {
            var originalClass = GetButton(r, c).className;
            if (originalClass == "GW") {
                GetButton(r, c).className = "GB";
            }
            else {
                GetButton(r, c).className = "GW";
            }
        }

        function SetColor(r, c, value) {
            if (value) {
                GetButton(r, c).className = "GB";
            }
            else {
                GetButton(r, c).className = "GW";
            }
        }

        function initHTML(size) {
            var inGame = "";
            for (ir = 0; ir < size; ir++) {
                inGame = inGame + initRow(ir, size);
            }
            document.getElementById("Game").innerHTML = inGame;
        }

        function initButton(r, c) {
            return '<td><button class="GW" onclick="buttonClick(' + r + ',' + c + ')" id="R' + r + 'C' + c + '"></button></td>\n';
        }

        function initRow(r, size) {
            var inRow = ""
            for (ic = 0; ic < size; ic++) {
                inRow = inRow + initButton(r, ic);
            }
            return '<tr>\n' + inRow + '</tr>\n'
        }

        function init() {
            let params = new URLSearchParams(location.search);
            if (params.has("size")) {
                var size = params.get("size");
            }
            else {
                size = NaN
            }
            size = parseInt(size);
            if (!(size >= 3)) {
                location.search = "size=" + prompt("请输入游戏尺寸 (整数)\n例: 3x3 -> 3")
            }
            initHTML(size);
            initGame(size);
        }

        // BW_Hash.js

        function GetFormHash() {
            var hashString = location.hash.substring(1);
            var lines = hashString.split(".");
            for (ir = 0; ir < lines.length; ir++) {
                for (ic = 0; ic < lines[ir].length; ic++) {
                    setBlock(ir, ic, lines[ir].substring(ic, ic + 1) == "1")
                }
            }
            MakeHash();
        }

        function MakeHash() {
            var outHash = "";
            for (ir = 0; ir < gameSize; ir++) {
                var temp = "";
                for (ic = 0; ic < gameSize; ic++) {
                    if (blocks[ir][ic]) {
                        temp = temp + "1";
                    }
                    else {
                        temp = temp + "0";
                    }
                }
                outHash = outHash + temp + ".";
            }
            outHash = outHash.substring(0, outHash.length - 1);
            location.hash = outHash;
        }

    </script>
    <title>黑白 单文件网页版</title>
</head>

<body>
    <h1>黑白</h1>
    <div>
        <button onclick="clearGame();">清空</button>
        <button onclick="randomClick();">常规生成</button>
        <button onclick="randomSet();">直接生成</button>
        <button onclick="location.search='size=ask';">更改尺寸</button>
    </div>
    <div>
        <table id="Game">

        </table>
    </div>
    <p>v23.02.23</p>
    <script>
        init();
        GetFormHash();
    </script>
</body>

</html>